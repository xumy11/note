```
1. form表单的enctype必须是：multipart/form-data
	*（enctype:是表单请求正文的类型。默认值为：application/x-www-form-urlencoded）

2. method必须是Post

3. 提供一个文件选择域<input type="file">
```

导入jar包

```xml
 <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>1.3.1</version>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
      <version>2.4</version>
    </dependency>
```

编写jsp页面

```
<formaction="/fileUpload"method="post"enctype="multipart/form-data">
	名称：<inputtype="text"name="picname"/><br/>
	图片：<inputtype="file"name="uploadFile"/><br/>
	<inputtype="submit"value="上传"/>
</form>
```

编写控制器

```java
@Controller("fileUploadController")
public class FileUploadController {
    @RequestMapping("/fileUpload")
    public String testResponseJson(String picname, MultipartFile uploadFile, HttpServletRequest request) throwsException {
        //定义文件名
        String fileName = "";
        //1.获取原始文件名
        String uploadFileName = uploadFile.getOriginalFilename();
        //2.截取文件扩展名
        String extendName = uploadFileName.substring(uploadFileName.lastIndexOf(".") + 1, uploadFileName.length());
        // 3.把文件加上随机数，防止文件重复
        String uuid = UUID.randomUUID().toString().replace("-", "").toUpperCase();
        // 4.判断是否输入了文件名
        if (!StringUtils.isEmpty(picname)) {
            fileName = uuid + "_" + picname + "." + extendName;
        } else {
            fileName = uuid + "_" + uploadFileName;
        }
        System.out.println(fileName);
        // 2.获取文件路径
        ServletContext context = request.getServletContext();
        String basePath = context.getRealPath("/uploads");
        //3.解决同一文件夹中文件过多问题
        String datePath = newSimpleDateFormat("yyyy-MM-dd").format(newDate());
        // 4.判断路径是否存在
        File file = newFile(basePath + "/" + datePath);
        if (!file.exists()) {
            file.mkdirs();
        }
        // 5.使用MulitpartFile接口中方法，把上传的文件写到指定位置
        uploadFile.transferTo(newFile(file, fileName));
        return "success";
    }
}
```

配置文件解析器

```xml
<!--配置文件上传解析器-->
    <!--id的值是固定的-->
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!--设置上传文件的最大尺寸为5MB -->
        <property name="maxUploadSize">
        <value>5242880</value>
        </property>
    </bean>
```

## SpringBoot文件上传

```java
/**
 * 定位文件位置  浏览文件时需要配置
 */
@Configuration
public class FileConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // System.getProperty("user.dir") 获取当前目录地址
        // System.getProperty("file.separator") 适配windows和linux不同的“/”.“\\”
        registry.addResourceHandler("/img/singerPic/**").addResourceLocations(
                "file:" + System.getProperty("user.dir") + System.getProperty("file.separator") + "img"
                + System.getProperty("file.separator") + "singerPic" + System.getProperty("file.separator"));
    }
}
```

```java
	/**
     * 上传歌手图片
     */
    @RequestMapping("/updateSingerPic")
    public Object updateSingerPic(MultipartFile file, Integer id) {
        JSONObject jsonObject = new JSONObject();
        if (file.isEmpty()) {
            jsonObject.put("code",0);
            jsonObject.put("msg","文件上传失败");
            return jsonObject;
        }
        //  文件名 = 当前时间（精确到毫秒）+原来文件名
        String fileName = System.currentTimeMillis() + file.getOriginalFilename();
        // 文件路径
        String filePath = System.getProperty("user.dir")+System.getProperty("file.separator")+"img"
                +System.getProperty("file.separator")+"singerPic";
        // 如果路径不存在 新增该路径
        File file1 = new File((filePath));
        if (!file1.exists()) {
            file1.mkdir();
        }

        // 实际的文件地址
        File dest = new File(filePath + System.getProperty("file.separator") + fileName);
        // 储存到数据库里的是相对文件地址
        String relativePath = "/img/singerPic/" + fileName;
        try {
            file.transferTo(dest);
            Singer singer = new Singer();
            singer.setId(id);
            singer.setPic(relativePath);
            boolean flag = singerService.updatePic(singer);
            if (flag) {
                jsonObject.put("code",1);
                jsonObject.put("msg","上传成功");
                jsonObject.put("pic",relativePath);
                return jsonObject;
            }
            jsonObject.put("code",0);
            jsonObject.put("msg","上传失败");
            return jsonObject;
        } catch (IOException e) {
            e.printStackTrace();
            jsonObject.put("code",0);
            jsonObject.put("msg","上传失败"+e.getMessage());
        }finally {
            return jsonObject;
        }
    }
```

